# Book Store API

REST API для потенциального книжного магазина. Написано
на Spring Web (архитектура MVC) с использованием следующих
зависимостей:

* `lombok` - для сокращения boilerplate кода в классах сущностей
* `mysql-connector-java` - для подключения к базе данных MySQL
* `gson` - для парсинга JSON строк
* `mockito-all` - для тестирования приложения с использованием Mock объектов
* `springdoc-openapi-ui` - для автоматической генерации OpenAPI документации

## Сборка и запуск
### С помощью maven

Требуемая версия Java - 18.

`mvn clean install` - сгенерирует JAR with dependencies.

`java -jar BookstoreAPI.jar [data.json] [logs.txt]` - запускает
сервер. Опционально принимает первым аргументом путь к JSON файлу с данными, которые
будут занесены в базу данных при запуске, вторым аргументом -
путь к файлу для записи логов.

Пример содержимого JSON файла:

```json
{
    "accounts": [
        {
            "balance": 100
        }
    ],
    "books": [
        {
            "author": "Стив Макконелл",
            "name": "Совершенный код",
            "price": 1000,
            "amount": 7
        }
    ]
}
```

Требует соединения с внешней базой данных MySQL, поэтому ее
необходимо заранее поднять.
Параметры соединения указываются
в файле `src/main/resources/application.properties`,
SQL дампы структур таблиц находятся в `mysql_dumps`.

### С помощью docker

`docker-compose up` - собирает и запускает сервер вместе с базой
данных, ничего дополнительно поднимать не нужно.

## Описание реализации
Данный API представляет собой полноценное CRUD-приложение,
т.е. поддерживает создание, чтение, модификацию и удаление сущностей.
(сущностей здесь три типа: аккаунт, книга и сделка)

Надеюсь, что это не сочтется за отклонение от ТЗ (например,
потому, что API оперирует произвольным количеством сущностей
"Аккаунт", а не одной, как требовалось в задании)

### Модели (сущности)
Основные модели (`Account`, `Book` и `Deal`) наследуются
от базовой `EntityBase`, которая содержит в себе общее для всех
поле - `id`.

Помимо основных, API оперирует request и response моделями,
которые описывают запросы к серверу и ответы сервера соответстенно.

Для конвертации основных моделей из/в request/response исопльзуются
сервисы `RequestMapper` и `ResponseMapper` соответственно.

### Документация
Полная документация к эндпоинтам и сущностям расположена на сервере по адресу 
`/api/v1/swagger-ui/index.html`.

### Прочие моменты
Эндпоинты отличаются от обозначенных в ТЗ:
* `GET /account` стал `GET /api/v1/accounts/{accountId}`
* `GET /market` стал `GET /api/v1/books`
* `POST /market/deal` стал `POST /api/v1/deals`

Отличается и тело POST запроса на создание сделки,
добавлен идентификатор аккаунта-покупателя. Вот пример:
```json
{
  "book_id": 1,
  "account_id": 1,
  "amount": 4
}
```
